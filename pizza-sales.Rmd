---
title: "pizza-sales"
author: "Nguyen Thi Ngoc Han"
date: "2024-11-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

# Phần 1. Tóm tắt:

# Phần 2. Giới thiệu:

# Phần 3. Mục tiêu phân tích:

# Phần 4. Thông tin về tập dữ liệu:

```{r}
sales_df <- read_excel("./data/Pizza Sales.xlsx")

head(sales_df)
```
```{r}
str(sales_df)
```

# Phần 5. Làm sạch và xử lý dữ liệu:

Sao chép dữ liệu vào biến df để xử lý trên bản sao không gây ảnh hưởng đến dữ liệu gốc.
```{r}
df <- sales_df
```

## 5.1. Kiểm tra giá trị thiếu (na) và trùng lặp (duplicate)
* Kiểm tra xem có tồn tại giá trị thiếu (na) ở các cột hay không
```{r}
colSums(is.na(df))
```
Không tồn tại giá trị na.

* Kiểm tra xem có tồn tại duplicate hay không
```{r}
any(duplicated(df))
```
Không có quan sát nào bị trùng lặp

## 5.2. Chuyển đổi cột pizza_size, pizza_category thành factor

Xem các giá trị duy nhất của cột pizza_size và pizza_category để xác định thành phần trong levels của factor
```{r}
unique(df$pizza_size)
unique(df$pizza_category)
```
Thực hiện chuyển đổi thành factor
```{r}
df$pizza_size <- factor(df$pizza_size, levels = c("S", "M", "L", "XL", "XXL"))
df$pizza_category <- factor(df$pizza_category)
```

## 5.3. Tạo cột order_hour

Dữ liệu của cột order_time là kiểu POSIXct và hiển thị dưới dạng yyyy-mm-dd HH:mm:ss. Nhằm phục vụ mục đích phân tích, em sẽ dựa vào cột này để tạo cột mới có tên order_hour thể hiện giờ đặt bánh của khách.
```{r}
df$order_time <- format(df$order_time, "%H:%M:%S")

df <- df %>% mutate(order_hour = sub("(..:..):..", "\\1", df$order_time))
```

Kiểm tra lại dữ liệu
```{r}
head(df)
```

## 5.4. Tạo cột order_weekday

Thêm cột mới tên order_weekday cho biết khách hàng đã đặt đơn vào thứ mấy.
```{r}
df <- mutate(df, order_weekday = weekdays(order_date))
```

## 5.4. Tạo cột order_month
Thêm cột mới tên order_weekday cho biết khách hàng đã đặt đơn vào tháng nào bằng cách format giá trị của cột order_date.
```{r}
df <- mutate(df, order_month = format(order_date, "%B"))
```

# Phần 6. Phân tích dữ liệu:

## 6.1. Phân tích tổng quan:

## 6.2. Phân tích nhu cầu tiêu thụ pizza theo thời gian:

## 6.3. Phân tích thành phần nguyên liệu:

## 6.4. Phân tích lượng sales và doanh thu theo pizza, size, category:

### 6.4.1. Lượng sales và doanh thu theo kích thước pizza

* Tính lượng bánh pizza bán được, tổng doanh thu và trung bình doanh thu mỗi đơn theo kích thước bánh pizza 
```{r}
sales_by_size <- df %>%
  group_by(pizza_size) %>%
  summarise(
    total_revenue = sum(total_price)
  )

sales_by_size
```
* Trực quan hóa tổng Doanh Thu theo kích thước pizza

```{r}
ggplot(sales_by_size, aes(x = pizza_size, y = total_revenue, fill = pizza_size)) +
  geom_bar(stat = "identity") +
  labs(title = "Tổng Doanh Thu theo Kích Thước Pizza", x = "Kích Thước Pizza", y = "Tổng Doanh Thu") +
  theme_minimal()
```
* Kiểm định giả thuyết thống kê
```{r}
anova_size <- aov(total_revenue ~ pizza_size, data = sales_by_size)
summary(anova_size)
```
```{r}
# Assuming df is your original dataframe
df1 <- df %>%
  group_by(pizza_size, pizza_category) %>%
  summarise(price = median(total_price), .groups = 'drop')

# Create a treemap using ggplot2
ggplot(df1, aes(area = price, fill = pizza_size, label = pizza_category)) +
  geom_treemap() +
  geom_treemap_text(colour = "white", place = "centre", grow = TRUE) +
  scale_fill_manual(values = c('lightgrey', 'gold', 'darkblue')) +
  theme_minimal() +
  labs(title = "Treemap of Pizza Prices", fill = "Pizza Size")
```


# Phần 7. Xây dựng mô hình dự đoán:

## 7.1. Dự đoán lượng đặt hàng của từng loại và kích thước pizza theo thời gian:

## 7.2. Dự đoán doanh thu của 6 tháng tiếp theo:

## 7.3. Dự báo nhu cầu nguyên liệu theo ngày trong tuần

# Phần 8. Kết luận

# Phần 9. Phụ lục

# Phần 10. Đóng góp





