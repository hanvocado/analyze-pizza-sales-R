knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(ggplot2)
library(arules)
library(arulesViz)
library(car)
library(randomForest)
sales_df <- read_excel("./data/Pizza Sales.xlsx")
head(sales_df)
str(sales_df)
df <- sales_df
colSums(is.na(df))
any(duplicated(df))
unique(df$pizza_size)
unique(df$pizza_category)
df$pizza_size <- factor(df$pizza_size, levels = c("S", "M", "L", "XL", "XXL"))
df$pizza_category <- factor(df$pizza_category)
temp_time <- format(df$order_time, "%H:%M:%S")
df <- df %>% mutate(order_hour = sub("(..):..:..", "\\1", temp_time))
head(df)
df <- mutate(df, order_weekday = weekdays(order_date))
df$order_weekday <- factor(df$order_weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))
head(df)
df <- mutate(df, order_month = format(order_date, "%B"))
df$order_month <- factor(df$order_month, levels = c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"))
head(df)
by_order_df <- df %>% group_by(order_id) %>%
summarise(quantity = sum(quantity), order_date = order_date[1], total_price = sum(total_price), order_hour = order_hour[1], order_weekday = order_weekday[1], order_month = order_month[1]) %>% ungroup()
head(by_order_df)
by_order_df %>% count()
by_order_df %>% summarise(no_pizzas = sum(quantity), total_revenue = sum(total_price))
by_order_df %>% select(quantity, total_price) %>% summary()
ggplot(data = df, aes(x = order_hour, y = quantity)) +
geom_col(fill = "blue") +
theme_minimal() +
labs(x = "Hour", y = "Frequency", title = "Pizza Consumption Demand by Hour") +
theme(plot.title = element_text(hjust = 0.5)
)
ggplot(data = df, aes(x = order_weekday, y = quantity)) +
geom_col(fill = "blue") +
theme_minimal() +
labs(x = "Date", y = "Frequency", title = "Pizza Consumption Demand by Day") +
theme(plot.title = element_text(hjust = 0.5)
)
ggplot(data = df, aes(x = order_month, y = quantity)) +
geom_col(fill = "blue") +
theme_minimal() +
labs(x = "Months", y = "Frequency", title = "Pizza Consumption Demand by Month") +
theme(axis.text.x = element_text(angle = 90, hjust = 1) ,
plot.title = element_text(hjust = 0.5))
ggplot(by_order_df, aes(x = order_month, fill = order_weekday)) +
geom_bar(position = "dodge", color = "black") +
scale_fill_brewer(palette = "Pastel1") +
theme_minimal() +
labs(x = "Months", y = "Frequency", title = "Pizza Consumption Demand by Day of the Week for Each Month") +
theme(axis.text.x = element_text(angle = 90, hjust = 1) ,
plot.title = element_text(hjust = 0.5))
ggplot(data = by_order_df, aes(x = order_weekday, y = order_hour, color = order_weekday)) +
geom_jitter(width = 0.2, height = 0) + # Tạo độ nhiễu ngang để các điểm không bị chồng lên nhau
theme_minimal() +
labs(x = "Order Dates", y = "Hour", title = "Pizza Consumption Demand by Hour of the Dates") +
theme(
legend.position = "none",
plot.title = element_text(hjust = 0.5)
)
df_table <- table(by_order_df$order_hour, by_order_df$order_weekday)
df_freq <- as.data.frame(df_table)
colnames(df_freq) <- c("Hour", "Day", "Frequency")
ggplot(df_freq, aes(x = Hour, y = Frequency, fill = Day)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8))  +
scale_fill_manual(values = c("blue", "red", "green", "yellow", "magenta", "cyan", "purple", "orange")) +
theme_minimal() +
labs(title = "Pizza Consumption Frequency by Hour of the Day", x = "Hour", y = "Frequency") +
theme(
plot.title = element_text(hjust = 0.5),
legend.title = element_blank()
) +
theme(legend.position = "right") +
theme(plot.margin = unit(c(1,1,1,1), "cm")) +
scale_x_discrete(expand = expansion(mult = c(0.1, 0.1)))
sales_by_pizza <- df %>%
group_by(pizza_name) %>%
summarise(total_sales = sum(quantity))
sprintf("Số bánh pizza cửa hàng kinh doanh: %s", length(sales_by_pizza$pizza_name))
sales_by_pizza %>%
ggplot(aes(x = total_sales, y = reorder(pizza_name, total_sales))) +
geom_col(color = "pink", fill = "pink", width = 0.5) +
labs(title = "Doanh số bán hàng",
x = "Số lượng",
y = "Pizza") +
theme_minimal()
df %>% select(pizza_name, pizza_size, unit_price, pizza_category, pizza_ingredients) %>%
group_by(pizza_name) %>% filter(pizza_name == 'The Classic Deluxe Pizza' | pizza_name == 'The Brie Carre Pizza' | pizza_name == 'The Mediterranean Pizza') %>% unique()
df %>% select(pizza_name, pizza_size) %>% unique() %>%
group_by(pizza_name) %>% summarise(no_variants = n()) %>%
merge(sales_by_pizza) %>% ggplot(aes(x = no_variants, y = total_sales)) + geom_point()
sales_by_size <- df %>%
group_by(pizza_size, order_month) %>%
summarise(
total_sales = sum(quantity)
)
head(sales_by_size)
ggplot(sales_by_size, aes(x = "", y = total_sales, fill = pizza_size)) +
geom_bar(stat = "identity") +
coord_polar(theta = "y") +
labs(title = "Doanh thu theo kích cỡ pizza") +
theme_void()
sales_by_category <- df %>%
group_by(pizza_category, order_month) %>%
summarise(
total_sales = sum(quantity)
)
sales_by_category
ggplot(sales_by_category, aes(x = pizza_category, y = total_sales, fill = order_month)) +
geom_col() +
labs(title = "Doanh số năm 2015 của từng danh mục bánh",
x = "Danh mục",
y = "Doanh số",
fill = "Tháng") +
theme_minimal()
sales_data <- df %>%  group_by(unit_price, pizza_size, pizza_category, order_month) %>% summarise(sales = sum(quantity))
sales_data %>%
ggplot(aes(x = unit_price, y = sales, color = pizza_size, shape = pizza_category)) +
geom_jitter()
lm_sales_model <- lm(sales ~ unit_price * (pizza_size + pizza_category), data = sales_data)
summary(lm_sales_model)
set.seed(123)
train_index <- sample(nrow(sales_data), 0.8 * nrow(sales_data))
train_data <- sales_data[train_index, ]
test_data <- sales_data[-train_index, ]
rf_sales_model <- randomForest(sales ~ unit_price + pizza_size + pizza_category, data = train_data)
rf_sales_model
plot(rf_sales_model)
tune_rf <- tuneRF(sales_data[, -which(names(sales_data) == "sales")], sales_data$sales)
rf_sales_model <- randomForest(sales ~ unit_price + pizza_size + pizza_category, data = train_data, mtry = 2)
rf_sales_model
predicted_sales <- predict(rf_sales_model, newdata = test_data)
head(predicted_sales)
actual_values <- test_data$sales
# Tính R2 (R-squared)
ss_total <- sum((actual_values - mean(actual_values))^2)
ss_residual <- sum((actual_values - predicted_sales)^2)
r_squared <- 1 - (ss_residual / ss_total)
cat("R-squared:", r_squared)
# Tính toán lỗi RMSE (Root Mean Squared Error)
rmse <- sqrt(mean((predicted_sales - actual_values)^2))
cat("RMSE", rmse)
knitr::opts_chunk$set(echo = TRUE)
vif(m_semi_full)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(openintro)
library(GGally)
library(broom)
glimpse(evals)
evals
# Thống kê các thông số cơ bản của score
evals %>%
summarize(
mean = mean(score, na.rm = TRUE),
median = median(score, na.rm = TRUE),
sd = sd(score, na.rm = TRUE),
min = min(score, na.rm = TRUE),
max = max(score, na.rm = TRUE)
)
# Biểu đồ histogram
evals %>% ggplot(aes(x = score)) + geom_histogram() + labs(title = "Sự phân bố của score")
# Biểu đồ quantile-quantile
ggplot(evals, aes(sample = score)) +
stat_qq() +
stat_qq_line(color = "red") +
labs(title = "Q-Q Plot của score", x = "Quantils của phân phối chuẩn", y = "Quantiles của score")
evals %>% ggplot(aes(x = age, y = bty_avg)) + geom_point() + geom_smooth(method = "lm")
ggplot(data = evals, aes(x = bty_avg, y = score)) +   geom_point()
dim(evals)
ggplot(data = evals, aes(x = bty_avg, y = score)) +   geom_jitter()
m_bty <- lm(score ~ bty_avg, data = evals)
summary(m_bty)$coefficients
ggplot(data = evals, aes(x = bty_avg, y = score)) +   geom_jitter() +   geom_smooth(method = "lm")
ggplot(data = evals, aes(x = bty_avg, y = score)) +   geom_jitter() +   geom_smooth(method = "lm", se = FALSE)
# Linearity và Constant variability
ggplot(data = m_bty, aes(x = .fitted, y = .resid)) +
geom_point(position = position_jitter()) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs( x = "Score dự đoán", y = "Residuals")
# Nearly normal residuals
ggplot(m_bty, aes(x = .resid)) +
geom_histogram()
ggplot(data = evals, aes(x = bty_f1lower, y = bty_avg)) +   geom_point()
evals %>%
summarise(cor(bty_avg, bty_f1lower))
evals %>%
select(contains("bty")) %>%
ggpairs()
m_bty_gen <- lm(score ~ bty_avg + gender, data = evals)
summary(m_bty_gen)
hist(m_bty_gen$residuals)
qqnorm(m_bty_gen$residuals)
qqline(m_bty_gen$residuals)
plot(m_bty_gen$residuals ~ evals$bty_avg)
abline(h = 0, lty = 4)
plot(m_bty_gen$residuals ~ evals$gender)
abline(h = 0, lty = 4)
plot(m_bty_gen)
plot(jitter(evals$score) ~ evals$bty_avg)
plot(evals$score ~ evals$gender)
m_bty_rank <- lm(score ~ bty_avg + rank, data = evals)
summary(m_bty_rank)
m_full <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + cls_profs + cls_credits + bty_avg, data = evals)
summary(m_full)
vif(m_semi_full)
m_semi_full <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + cls_credits + bty_avg, data = evals)
summary(m_semi_full)
vif(m_semi_full)
vif(m_full)
m1 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + bty_avg, data = evals) summary(m_drop7)
m1 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + bty_avg, data = evals) summary(m_drop7)
m1 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + bty_avg, data = evals)
summary(m1)
m3 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + bty_avg, data = evals)
summary(m3)
m4 <- lm(score ~ rank + gender + language + age + cls_perc_eval + cls_students + cls_level + cls_credits + bty_avg, data = evals)
summary(m4)
m5 <- lm(score ~ gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + cls_credits + bty_avg, data = evals)
summary(m5)
m6 <- lm(score ~ ethnicity + language + age + cls_perc_eval + cls_students + cls_level + cls_credits + bty_avg, data = evals)
summary(m6)
m7 <- lm(score ~ gender + ethnicity + age + cls_perc_eval + cls_students + cls_level + cls_credits + bty_avg, data = evals)
summary(m7)
m3 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_prof + bty_avg, data = evals)
m3 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_credits + bty_avg, data = evals)
summary(m3)
m4 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_level + cls_credits + bty_avg, data = evals)
summary(m4)
m5 <- lm(score ~ gender + ethnicity + language + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m5)
m6 <- lm(score ~ gender + ethnicity + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m6)
m7 <- lm(score ~ gender + ethnicity + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m7)
m4 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
m4$coefficients
m4 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
m4$effects
m4 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
m4$terms
m4 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m4)
plot(m_drop7$residuals ~ evals$score) abline(h = 0, lty = 3)
plot(m6$residuals ~ evals$score) abline(h = 0, lty = 3)
plot(m6$residuals ~ evals$score)
abline(h = 0, lty = 3)
hist(m6$residuals)
qqnorm(m_drop7$residuals)
qqnorm(m6$residuals)
qqline(m6$residuals)
df <- mutate(df, order_weekday = weekdays(order_date))
df$order_weekday <- factor(df$order_weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))
head(df)
View(df)
View(df)
by_order_df %>% ggplot(aes(x = total_price)) + geom_histogram()
by_order_df %>% ggplot(aes(x = total_price)) + geom_histogram(color = "#FF9999")
by_order_df %>% ggplot(aes(x = total_price)) + geom_histogram(fill = "#FF9999") +
labs(title = "Phân bố của giá trị một đơn hàng", x = "Giá trị")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(openintro)
library(GGally)
library(broom)
glimpse(evals)
# Lưu dữ liệu evals vào file CSV
write.csv(evals, "evals.csv", row.names = FALSE)
m3 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_level + cls_credits + bty_avg, data = evals)
summary(m3)
m3 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_students + cls_credits + bty_avg, data = evals)
summary(m3)
m4 <- lm(score ~ rank + gender + ethnicity + language + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m4)
m5 <- lm(score ~ gender + ethnicity + language + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m5)
m6 <- lm(score ~ gender + ethnicity + age + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m6)
m7 <- lm(score ~ gender + ethnicity + cls_perc_eval + cls_credits + bty_avg, data = evals)
summary(m7)
str(sales_data)
summary(lm_sales_model)
summary(sales_data)
